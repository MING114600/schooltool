[1mdiff --git a/src/hooks/useAudio.js b/src/hooks/useAudio.js[m
[1mindex 7f7b8ec..fd554c2 100644[m
[1m--- a/src/hooks/useAudio.js[m
[1m+++ b/src/hooks/useAudio.js[m
[36m@@ -1,11 +1,10 @@[m
[31m-import { useRef, useCallback, useState } from 'react';[m
[32m+[m[32mimport { useRef, useCallback } from 'react';[m
 [m
 export const useAudio = () => {[m
   const audioCtxRef = useRef(null);[m
[31m-  const [isPlaying, setIsPlaying] = useState(false);[m
 [m
[31m-  // åˆå§‹åŒ– AudioContext[m
[31m-  const initAudio = () => {[m
[32m+[m[32m  // åˆå§‹åŒ– AudioContextï¼šç¢ºä¿å–®ä¸€å¯¦ä¾‹[m
[32m+[m[32m  const initAudio = useCallback(() => {[m
     if (!audioCtxRef.current) {[m
       const AudioContext = window.AudioContext || window.webkitAudioContext;[m
       audioCtxRef.current = new AudioContext();[m
[36m@@ -14,154 +13,93 @@[m [mexport const useAudio = () => {[m
       audioCtxRef.current.resume();[m
     }[m
     return audioCtxRef.current;[m
[31m-  };[m
[32m+[m[32m  }, []);[m
 [m
[31m-  // é€šç”¨åˆæˆå™¨å‡½æ•¸[m
[31m-  const playTone = (freq, type, duration, volume = 0.1) => {[m
[31m-    const ctx = initAudio();[m
[32m+[m[32m  // å„ªåŒ–ï¼šé«˜éšéŸ³æ•ˆç”¢ç”Ÿå™¨ (è®“ç‰¹å®šæ•ˆæœèƒ½è¤‡ç”¨åº•å±¤é‚è¼¯ï¼Œä½†ä¿æœ‰ç¨ç«‹åƒæ•¸)[m
[32m+[m[32m  const createSimpleTone = useCallback((ctx, freq, type, start, duration, volume) => {[m
     const osc = ctx.createOscillator();[m
     const gain = ctx.createGain();[m
[31m-[m
     osc.type = type;[m
[31m-    osc.frequency.setValueAtTime(freq, ctx.currentTime);[m
[31m-    [m
[31m-    // éŸ³é‡åŒ…çµ¡ç·š[m
[31m-    gain.gain.setValueAtTime(volume, ctx.currentTime);[m
[31m-    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);[m
[31m-[m
[32m+[m[32m    osc.frequency.setValueAtTime(freq, start);[m
[32m+[m[32m    gain.gain.setValueAtTime(volume, start);[m
[32m+[m[32m    gain.gain.exponentialRampToValueAtTime(0.001, start + duration);[m
     osc.connect(gain);[m
     gain.connect(ctx.destination);[m
[31m-[m
[31m-    osc.start();[m
[31m-    osc.stop(ctx.currentTime + duration);[m
[31m-  };[m
[32m+[m[32m    osc.start(start);[m
[32m+[m[32m    osc.stop(start + duration);[m
[32m+[m[32m  }, []);[m
 [m
   const playAudio = useCallback((soundType) => {[m
     const ctx = initAudio();[m
     const now = ctx.currentTime;[m
 [m
     switch (soundType) {[m
[31m-      case 'positive': // åŠ åˆ†[m
[31m-        playTone(1046.50, 'sine', 0.8, 0.2);[m
[32m+[m[32m      case 'positive':[m
[32m+[m[32m        createSimpleTone(ctx, 1046.50, 'sine', now, 0.6, 0.15);[m
         break;[m
[31m-        [m
[31m-      case 'correct': // ç­”å°[m
[31m-        {[m
[31m-          const osc1 = ctx.createOscillator(); const gain1 = ctx.createGain();[m
[31m-          osc1.type = 'triangle'; osc1.frequency.value = 523.25;[m
[31m-          gain1.gain.setValueAtTime(0.1, now); gain1.gain.exponentialRampToValueAtTime(0.01, now + 0.4);[m
[31m-          osc1.connect(gain1); gain1.connect(ctx.destination);[m
[31m-          osc1.start(now); osc1.stop(now + 0.4);[m
 [m
[31m-          const osc2 = ctx.createOscillator(); const gain2 = ctx.createGain();[m
[31m-          osc2.type = 'triangle'; osc2.frequency.value = 659.25;[m
[31m-          gain2.gain.setValueAtTime(0.1, now + 0.1); gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.5);[m
[31m-          osc2.connect(gain2); gain2.connect(ctx.destination);[m
[31m-          osc2.start(now + 0.1); osc2.stop(now + 0.5);[m
[31m-[m
[31m-          const osc3 = ctx.createOscillator(); const gain3 = ctx.createGain();[m
[31m-          osc3.type = 'sine'; osc3.frequency.value = 783.99;[m
[31m-          gain3.gain.setValueAtTime(0.2, now + 0.2); gain3.gain.exponentialRampToValueAtTime(0.01, now + 1.0);[m
[31m-          osc3.connect(gain3); gain3.connect(ctx.destination);[m
[31m-          osc3.start(now + 0.2); osc3.stop(now + 1.0);[m
[31m-        }[m
[32m+[m[32m      case 'correct': // ä¿ç•™å’Œå¼¦ç´°ç¯€[m
[32m+[m[32m        [523.25, 659.25, 783.99].forEach((f, i) => {[m
[32m+[m[32m          createSimpleTone(ctx, f, 'triangle', now + i * 0.1, 0.5, 0.1);[m
[32m+[m[32m        });[m
         break;[m
 [m
[31m-      case 'negative': // æ‰£åˆ†[m
[31m-        playTone(150, 'sawtooth', 0.4, 0.15);[m
[32m+[m[32m      case 'negative':[m
[32m+[m[32m        createSimpleTone(ctx, 150, 'sawtooth', now, 0.4, 0.1);[m
         break;[m
 [m
[31m-      case 'wrong': // ç­”éŒ¯[m
[32m+[m[32m      case 'wrong': // åŸå‰µæ»‘éŸ³æ•ˆæœ (ä¿ç•™åŸå§‹è¤‡é›œé‚è¼¯)[m
         {[m
[31m-            const osc1 = ctx.createOscillator(); const gain1 = ctx.createGain();[m
[31m-            osc1.type = 'sawtooth'; osc1.frequency.setValueAtTime(150, now); osc1.frequency.linearRampToValueAtTime(100, now + 0.5);[m
[31m-            gain1.gain.setValueAtTime(0.15, now); gain1.gain.linearRampToValueAtTime(0.01, now + 0.5);[m
[31m-            osc1.connect(gain1); gain1.connect(ctx.destination);[m
[31m-            osc1.start(now); osc1.stop(now + 0.5);[m
[32m+[m[32m          const osc = ctx.createOscillator();[m
[32m+[m[32m          const gain = ctx.createGain();[m
[32m+[m[32m          osc.type = 'sawtooth';[m
[32m+[m[32m          osc.frequency.setValueAtTime(150, now);[m
[32m+[m[32m          osc.frequency.linearRampToValueAtTime(100, now + 0.5);[m
[32m+[m[32m          gain.gain.setValueAtTime(0.1, now);[m
[32m+[m[32m          gain.gain.linearRampToValueAtTime(0.001, now + 0.5);[m
[32m+[m[32m          osc.connect(gain);[m
[32m+[m[32m          gain.connect(ctx.destination);[m
[32m+[m[32m          osc.start(now);[m
[32m+[m[32m          osc.stop(now + 0.5);[m
         }[m
         break;[m
 [m
[31m-      case 'alert': // è­¦å‘Š[m
[31m-        {[m
[31m-            for(let i=0; i<3; i++) {[m
[31m-                const t = now + i * 0.15;[m
[31m-                const osc = ctx.createOscillator(); const gain = ctx.createGain();[m
[31m-                osc.type = 'square'; osc.frequency.value = 880;[m
[31m-                gain.gain.setValueAtTime(0.1, t); gain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);[m
[31m-                osc.connect(gain); gain.connect(ctx.destination);[m
[31m-                osc.start(t); osc.stop(t + 0.1);[m
[31m-            }[m
[31m-        }[m
[31m-        break;[m
[31m-        [m
[31m-      case 'applause': // æ­¡å‘¼[m
[31m-        {[m
[31m-           const notes = [523.25, 659.25, 783.99, 1046.50];[m
[31m-           notes.forEach((freq, i) => {[m
[31m-               const t = now + i * 0.05;[m
[31m-               const osc = ctx.createOscillator(); const gain = ctx.createGain();[m
[31m-               osc.type = 'triangle'; osc.frequency.value = freq;[m
[31m-               gain.gain.setValueAtTime(0.1, t); gain.gain.exponentialRampToValueAtTime(0.01, t + 1.5);[m
[31m-               osc.connect(gain); gain.connect(ctx.destination);[m
[31m-               osc.start(t); osc.stop(t + 1.5);[m
[31m-           });[m
[32m+[m[32m      case 'alert': // åŸå‰µè­¦å‘Šé€£éŸ³[m
[32m+[m[32m        for (let i = 0; i < 3; i++) {[m
[32m+[m[32m          createSimpleTone(ctx, 880, 'square', now + i * 0.15, 0.1, 0.05);[m
         }[m
         break;[m
 [m
[31m-      case 'drumroll': // æŠ½ç±¤æ»¾å‹•[m
[31m-         {[m
[31m-           const osc = ctx.createOscillator();[m
[31m-           const gain = ctx.createGain();[m
[31m-           osc.type = 'square';[m
[31m-           osc.frequency.setValueAtTime(100, now);[m
[31m-           gain.gain.setValueAtTime(0.1, now);[m
[31m-           gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);[m
[31m-           osc.connect(gain);[m
[31m-           gain.connect(ctx.destination);[m
[31m-           osc.start(now);[m
[31m-           osc.stop(now + 0.1);[m
[31m-         }[m
[31m-         break;[m
[32m+[m[32m      case 'applause': // åŸå‰µæ­¡å‘¼æ•ˆæœ[m
[32m+[m[32m        [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {[m
[32m+[m[32m          const t = now + i * 0.05;[m
[32m+[m[32m          const osc = ctx.createOscillator();[m
[32m+[m[32m          const gain = ctx.createGain();[m
[32m+[m[32m          osc.type = 'triangle';[m
[32m+[m[32m          osc.frequency.value = freq;[m
[32m+[m[32m          gain.gain.setValueAtTime(0.1, t);[m
[32m+[m[32m          gain.gain.exponentialRampToValueAtTime(0.01, t + 1.5);[m
[32m+[m[32m          osc.connect(gain);[m
[32m+[m[32m          gain.connect(ctx.destination);[m
[32m+[m[32m          osc.start(t);[m
[32m+[m[32m          osc.stop(t + 1.5);[m
[32m+[m[32m        });[m
[32m+[m[32m        break;[m
 [m
[31m-      // âœ… æ–°å¢ï¼šæœ€å¾Œå€’æ•¸æ»´ç­”è² (Tick)[m
[31m-      case 'tick':[m
[31m-         {[m
[31m-           // çŸ­ä¿ƒçš„é«˜é »è² (é¡ä¼¼æœ¨é­šæˆ–é›»å­éŒ¶æ»´ç­”)[m
[31m-           const osc = ctx.createOscillator();[m
[31m-           const gain = ctx.createGain();[m
[31m-           osc.type = 'triangle'; // ä½¿ç”¨ä¸‰è§’æ³¢æ¯”è¼ƒæ¸…è„†[m
[31m-           osc.frequency.setValueAtTime(1000, now); [m
[31m-           gain.gain.setValueAtTime(0.15, now);[m
[31m-           gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);[m
[31m-           osc.connect(gain);[m
[31m-           gain.connect(ctx.destination);[m
[31m-           osc.start(now);[m
[31m-           osc.stop(now + 0.1);[m
[31m-         }[m
[31m-         break;[m
[32m+[m[32m      case 'tick': // åŸå‰µæ»´ç­”è²[m
[32m+[m[32m        createSimpleTone(ctx, 1000, 'triangle', now, 0.1, 0.15);[m
[32m+[m[32m        break;[m
 [m
[31m-      case 'alarm': // æ™‚é–“åˆ°[m
[31m-         {[m
[31m-             for(let i=0; i<4; i++) {[m
[31m-                const t = now + i * 0.2;[m
[31m-                const osc = ctx.createOscillator();[m
[31m-                const gain = ctx.createGain();[m
[31m-                osc.type = 'square';[m
[31m-                osc.frequency.value = 2000;[m
[31m-                gain.gain.setValueAtTime(0.1, t);[m
[31m-                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);[m
[31m-                osc.connect(gain);[m
[31m-                gain.connect(ctx.destination);[m
[31m-                osc.start(t);[m
[31m-                osc.stop(t + 0.1);[m
[31m-             }[m
[31m-         }[m
[31m-         break;[m
[32m+[m[32m      case 'alarm': // åŸå‰µé¬§é˜é€£æ‹[m
[32m+[m[32m        for (let i = 0; i < 4; i++) {[m
[32m+[m[32m          createSimpleTone(ctx, 2000, 'square', now + i * 0.2, 0.1, 0.1);[m
[32m+[m[32m        }[m
[32m+[m[32m        break;[m
 [m
       default:[m
         break;[m
     }[m
[31m-  }, []);[m
[32m+[m[32m  }, [initAudio, createSimpleTone]);[m
 [m
   return { playAudio, initAudio };[m
 };[m
\ No newline at end of file[m
[1mdiff --git a/src/hooks/useClassData.js b/src/hooks/useClassData.js[m
[1mdeleted file mode 100644[m
[1mindex 9c540bd..0000000[m
[1m--- a/src/hooks/useClassData.js[m
[1m+++ /dev/null[m
[36m@@ -1,87 +0,0 @@[m
[31m-import { useState, useEffect, useCallback } from 'react';[m
[31m-[m
[31m-// é è¨­ç­ç´šè³‡æ–™ (å¾æ‚¨åŸæœ¬çš„ç¨‹å¼ç¢¼æå–)[m
[31m-const DEFAULT_CLASS = {[m
[31m-  id: 'default_class',[m
[31m-  name: 'ç¯„ä¾‹ç­ç´š',[m
[31m-  students: [[m
[31m-    { id: 's1', number: '01', name: 'ç‹å°æ˜', gender: 'M', group: '1', locked: false },[m
[31m-    // ... å…¶ä»–é è¨­å­¸ç”Ÿ ...[m
[31m-  ],[m
[31m-  layout: {[m
[31m-    rows: 4, [m
[31m-    cols: 8,[m
[31m-    doorSide: 'right', [m
[31m-    seats: {},[m
[31m-    voidSeats: [] [m
[31m-  },[m
[31m-  groupScores: {}, [m
[31m-  scoreLogs: [], [m
[31m-  attendanceRecords: {},[m
[31m-  behaviors: [[m
[31m-    { id: 'b1', icon: 'ğŸ‘', label: 'ç™¼è¡¨æ„è¦‹', score: 1, type: 'positive' },[m
[31m-    { id: 'b2', icon: 'ğŸ¤', label: 'å¹«åŠ©åŒå­¸', score: 1, type: 'positive' },[m
[31m-    { id: 'b3', icon: 'âœ…', label: 'ç§©åºè‰¯å¥½', score: 1, type: 'positive' },[m
[31m-    { id: 'b4', icon: 'ğŸ’¤', label: 'ä¸Šèª²ç¡è¦º', score: -1, type: 'negative' },[m
[31m-    { id: 'b5', icon: 'ğŸ—£ï¸', label: 'å¹²æ“¾ç§©åº', score: -1, type: 'negative' },[m
[31m-  ][m
[31m-};[m
[31m-[m
[31m-const STORAGE_KEY = 'schooltool_classes';[m
[31m-[m
[31m-export const useClassData = () => {[m
[31m-  const [classes, setClasses] = useState([]);[m
[31m-  const [loading, setLoading] = useState(true);[m
[31m-[m
[31m-  // è®€å–è³‡æ–™[m
[31m-  const refreshClasses = useCallback(() => {[m
[31m-    try {[m
[31m-      const saved = localStorage.getItem(STORAGE_KEY);[m
[31m-      if (saved) {[m
[31m-        setClasses(JSON.parse(saved));[m
[31m-      } else {[m
[31m-        setClasses([DEFAULT_CLASS]);[m
[31m-      }[m
[31m-    } catch (e) {[m
[31m-      console.error("Failed to load class data", e);[m
[31m-      setClasses([DEFAULT_CLASS]);[m
[31m-    } finally {[m
[31m-      setLoading(false);[m
[31m-    }[m
[31m-  }, []);[m
[31m-[m
[31m-  // åˆå§‹è®€å–[m
[31m-  useEffect(() => {[m
[31m-    refreshClasses();[m
[31m-  }, [refreshClasses]);[m
[31m-[m
[31m-  // å„²å­˜è³‡æ–™ (å…¨é‡æ›´æ–°)[m
[31m-  const saveClasses = useCallback((newClasses) => {[m
[31m-    try {[m
[31m-      localStorage.setItem(STORAGE_KEY, JSON.stringify(newClasses));[m
[31m-      setClasses(newClasses);[m
[31m-    } catch (e) {[m
[31m-      console.error("Failed to save class data", e);[m
[31m-      alert("å„²å­˜å¤±æ•—ï¼Œå¯èƒ½æ˜¯å„²å­˜ç©ºé–“ä¸è¶³");[m
[31m-    }[m
[31m-  }, []);[m
[31m-[m
[31m-  // æ›´æ–°å–®ä¸€ç­ç´š[m
[31m-  const updateClass = useCallback((updatedClass) => {[m
[31m-    setClasses(prevClasses => {[m
[31m-      const newClasses = prevClasses.map(c => [m
[31m-        c.id === updatedClass.id ? updatedClass : c[m
[31m-      );[m
[31m-      localStorage.setItem(STORAGE_KEY, JSON.stringify(newClasses));[m
[31m-      return newClasses;[m
[31m-    });[m
[31m-  }, []);[m
[31m-[m
[31m-  return {[m
[31m-    classes,[m
[31m-    loading,[m
[31m-    refreshClasses, // ç•¶ App åˆ‡æ› Tab æ™‚å¯ä»¥å‘¼å«é€™å€‹[m
[31m-    saveClasses,[m
[31m-    updateClass[m
[31m-  };[m
[31m-};[m
\ No newline at end of file[m
