import{c as Z,r as i,k as de,l as W,m as xe,A as ge,n as fe,j as e,b as c,X as K,P as ue,d as ce,o as je,R as me,h as ve,S as ke,M as Ne,u as we,g as ye,p as Se,q as Ee,s as Me,t as Ce,C as Te,f as Ae}from"./index-FQBKIusJ.js";import{u as Re,Z as Y}from"./ZhuyinRenderer-DZI8iNML.js";import{A as _e}from"./AttendanceModal-VEy16hDY.js";import{a as De,M as be,b as ze,V as $e,C as Oe,A as Ie}from"./volume-x-DBIkYyAc.js";import{U as Le}from"./upload-CS6GnmGO.js";import{P as he,V as Ue,b as Fe,a as Pe}from"./volume-2-DF--ebQ2.js";import{M as Be,T as ie,S as He,R as Qe}from"./timer-C1Lo72OE.js";const qe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ye=Z("chevron-left",qe);const Ve=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Xe=Z("chevron-right",Ve);const We=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],Ge=Z("circle-stop",We);const Ke=[["path",{d:"M19 19H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.7.7 0 0 1 2 21.286V5a2 2 0 0 1 1.184-1.826",key:"1wyg69"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.656 3H20a2 2 0 0 1 2 2v11.344",key:"mhl4k6"}]],Ze=Z("message-square-off",Ke);const Je=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],et=Z("mic",Je),tt=()=>{const l=i.useRef(null);i.useEffect(()=>{const s=async()=>{try{"wakeLock"in navigator&&(l.current=await navigator.wakeLock.request("screen"),console.log("Wake Lock is active"))}catch(h){console.warn("Wake Lock request failed:",h)}};s();const u=()=>{document.visibilityState==="visible"&&s()};return document.addEventListener("visibilitychange",u),()=>{l.current&&l.current.release(),document.removeEventListener("visibilitychange",u)}},[])},st=l=>l.getHours()*60+l.getMinutes(),se=l=>{const[s,u]=l.split(":").map(Number);return s*60+u},re=l=>l.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:!1}),at=xe.filter(l=>["p1","p2","p3"].includes(l.id)),nt=()=>{const{currentClass:l,updateAttendance:s}=de(),[u,h]=W("exam_is_manual_mode",!1,"1.0"),[r,p]=W("exam_manual_attendance",{expected:0,actual:0,note:""},"1.0"),k=new Date().toLocaleDateString("en-CA"),[x,f]=W("exam_schedule",at,"2.1"),[b,E]=W("exam_tts_rules",[],"1.0"),[o,w]=W("exam_quick_state",{start:null,end:null,title:"éš¨å ‚è€ƒ"},"1.0"),[A,j]=W("exam_announcements",{exam:["å¯«ä¸Šç­ç´šå§“å","ä¿æŒå®‰éœ","æ¡Œé¢æ·¨ç©º","æª¢æŸ¥è€ƒå·","æœ‰å•é¡Œè«‹èˆ‰æ‰‹"],break:["å–æ°´ä¸Šå»æ‰€","æº–å‚™å¥½è€ƒè©¦ç”¨å“","éœå¿ƒè¤‡ç¿’","ææ—©å›žæ•™å®¤"],active:!0},"1.0"),[O,F]=i.useState({}),P=(m,S)=>{if(!S)return;O[m]&&URL.revokeObjectURL(O[m]);const g=URL.createObjectURL(S);F(T=>({...T,[m]:g}))},Q=m=>{F(S=>{const g={...S};return g[m]&&(URL.revokeObjectURL(g[m]),delete g[m]),g})},[y,I]=i.useState(new Date),[R,B]=i.useState(0),{speak:H}=Re(),t=i.useRef(null),[a,n]=i.useState(!1),[_,M]=i.useState(null),[C,J]=i.useState(null),[G,ae]=i.useState("éš¨å ‚è€ƒ"),ee=(m,S="éš¨å ‚è€ƒ")=>{const g=new Date,T=new Date(g.getTime()+m*60*1e3);B(0),w({start:g.toISOString(),end:T.toISOString(),title:S})},V=()=>{B(0),w({start:null,end:null,title:"éš¨å ‚è€ƒ"})};i.useEffect(()=>{if(o.start&&o.end){const m=new Date(o.end);m.setMinutes(m.getMinutes()+R),y>=m&&V()}},[y,o,R]),i.useEffect(()=>{const m=setInterval(()=>I(new Date),1e3);return()=>clearInterval(m)},[]);const q=i.useMemo(()=>{const m=st(y);if(o.start&&o.end){const v=new Date(o.start),N=new Date(o.end);N.setMinutes(N.getMinutes()+R);const D=Math.floor((N-y)/1e3),$=Math.max(1,Math.floor((N-v)/1e3)),d=Math.max(0,Math.min(100,D/$*100));return D<=0?{status:"idle",message:"æ¸¬é©—çµæŸ",remainingSeconds:0,totalSeconds:1,progress:0,nextSlot:null,isQuickExam:!0}:{status:"exam",slot:{id:"quick-exam",name:o.title,start:re(v),end:re(N),type:"class"},nextSlot:null,remainingSeconds:D,totalSeconds:$,progress:d,audioUrl:null,isQuickExam:!0}}const S=[...x].sort((v,N)=>v.start.localeCompare(N.start)),g=S.find(v=>{const N=se(v.start),D=se(v.end);return m>=N&&m<D+R});if(g){const[v,N]=g.end.split(":").map(Number),D=new Date(y);D.setHours(v,N+R,0);const $=Math.floor((D-y)/1e3),[d,z]=g.start.split(":").map(Number),L=new Date(y);L.setHours(d,z,0);const U=Math.max(1,Math.floor((D-L)/1e3)),X=S[S.indexOf(g)+1]||null;return{status:g.type==="break"?"break":"exam",slot:g,nextSlot:X,remainingSeconds:Math.max(0,$),totalSeconds:U,progress:Math.max(0,Math.min(100,$/U*100)),audioUrl:O[g.id]||null,isQuickExam:!1}}const T=S.findIndex(v=>{const N=se(v.start);return m<N});if(T!==-1){const v=S[T],[N,D]=v.start.split(":").map(Number),$=new Date(y);if($.setHours(N,D,0),T>0){const d=S[T-1];if(m>=se(d.end)){const[z,L]=d.end.split(":").map(Number),U=new Date(y);U.setHours(z,L,0);const X=Math.floor(($-y)/1e3),te=Math.max(1,Math.floor(($-U)/1e3)),pe=Math.max(0,Math.min(100,X/te*100));return{status:"break",slot:{id:`gap-${d.id}`,name:"ä¸‹èª²ä¼‘æ¯",start:d.end,end:v.start,type:"break"},nextSlot:v,remainingSeconds:Math.max(0,X),totalSeconds:te,progress:pe,audioUrl:null,isQuickExam:!1}}}else if(T===0){const{PREP_MINUTES:d}=fe,z=new Date($);if(z.setMinutes($.getMinutes()-d),y>=z){const L=Math.floor(($-y)/1e3),U=d*60,X=Math.max(0,Math.min(100,L/U*100)),te=re(z);return{status:"break",slot:{id:`prep-${v.id}`,name:"è€ƒå‰æº–å‚™",start:te,end:v.start,type:"break"},nextSlot:v,remainingSeconds:Math.max(0,L),totalSeconds:U,progress:X,audioUrl:null,isQuickExam:!1}}}}return{status:"idle",message:"ç›®å‰ç„¡è€ƒè©¦",remainingSeconds:0,totalSeconds:1,progress:0,nextSlot:null,isQuickExam:!1}},[y,x,R,o,O]);i.useEffect(()=>{const m=q.status;if(a||m!=="exam"&&m!=="break")return;const S=q.remainingSeconds,g=b.find(T=>{const v=T.type||"exam";return T.enabled&&T.triggerAt===S&&v===m});g&&t.current!==S&&(H(g.text),t.current=S)},[q.remainingSeconds,q.status,a,b,H]);const ne=i.useMemo(()=>{if(u)return{expected:r.expected,actual:r.actual,absentees:r.note?[{id:"manual",name:r.note,isManualNote:!0}]:[]};if(!l)return{expected:0,actual:0,absentees:[]};const m=l.students||[],g=(l.attendanceRecords||{})[k]||{},T=m.filter(N=>{const D=g[N.id];return D==="absent"||D==="personal"}).map(N=>({...N,status:g[N.id]||"unknown",statusLabel:ge[g[N.id]]?.label||"æœªåˆ°"})),v=m.length-T.length;return{expected:m.length,actual:v,absentees:T}},[u,r,l,k]);return{now:y,schedule:x,setSchedule:f,ttsRules:b,setTtsRules:E,announcements:A,setAnnouncements:j,audioFiles:O,uploadAudio:P,removeAudio:Q,attendanceStats:ne,currentStatus:q,manualExtension:R,setManualExtension:B,isMuted:a,setIsMuted:n,speak:m=>{a||H(m)},isManualMode:u,setIsManualMode:h,manualData:r,setManualData:p,startQuickExam:ee,stopQuickExam:V,isQuickExam:!!o.start,today:k}},oe=({active:l,onClick:s,children:u})=>e.jsx("button",{onClick:s,className:`px-6 py-3 font-bold text-sm transition-all border-b-2 flex items-center gap-2 ${l?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:u}),lt=({isOpen:l,onClose:s,schedule:u,setSchedule:h,ttsRules:r,setTtsRules:p,announcements:k,setAnnouncements:x,uploadAudio:f,removeAudio:b,audioFiles:E})=>{const[o,w]=i.useState("schedule");if(!l)return null;const A=(t=null)=>{const a=t?{...t}:{id:Date.now().toString(),name:"æ–°è€ƒç§‘",start:"08:00",end:"09:00",type:"class"};a.id=Date.now().toString()+Math.random(),h(n=>[...n,a].sort((_,M)=>_.start.localeCompare(M.start)))},j=(t,a,n)=>h(_=>_.map(M=>M.id===t?{...M,[a]:n}:M)),O=t=>h(a=>a.filter(n=>n.id!==t)),F=()=>{p(t=>[...t,{id:Date.now().toString(),triggerAt:60,text:"è«‹æ³¨æ„æ™‚é–“",type:"exam",enabled:!0}])},P=(t,a,n)=>{p(_=>_.map(M=>M.id===t?{...M,[a]:n}:M))},Q=t=>{p(a=>a.filter(n=>n.id!==t))},y=(t,a)=>{const n=t.target.files[0];n&&f(a,n)},I=(t,a,n)=>{const _=[...k[t]];_[a]=n,x(M=>({...M,[t]:_}))},R=t=>{x(a=>({...a,[t]:[...a[t],""]}))},B=(t,a)=>{x(n=>({...n,[t]:n[t].filter((_,M)=>M!==a)}))},H={exam:["æ‰‹æ©Ÿé—œæ©Ÿ","å¯«ä¸Šç­ç´šå§“å","ä¿æŒå®‰éœ","æ¡Œé¢æ·¨ç©º","æª¢æŸ¥è€ƒå·","æœ‰å•é¡Œè«‹èˆ‰æ‰‹"],break:["å–æ°´ä¸Šå»æ‰€","æº–å‚™å¥½è€ƒè©¦ç”¨å“","éœå¿ƒè¤‡ç¿’","ææ—©å›žæ•™å®¤"]};return e.jsx("div",{className:"fixed inset-0 z-[150] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:`w-full max-w-4xl h-[85vh] flex flex-col rounded-2xl shadow-2xl overflow-hidden ${c.SURFACE_MAIN}`,children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:"è€ƒå ´è¨­å®š"}),e.jsx("button",{onClick:s,children:e.jsx(K,{className:"text-slate-400 hover:text-slate-600"})})]}),e.jsxs("div",{className:"flex border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs(oe,{active:o==="schedule",onClick:()=>w("schedule"),children:[e.jsx(De,{size:16})," è€ƒç¨‹èˆ‡éŸ³æª”"]}),e.jsxs(oe,{active:o==="announcement",onClick:()=>w("announcement"),children:[e.jsx(be,{size:16})," æ–‡å­—è¼ªæ’­"]}),e.jsxs(oe,{active:o==="tts",onClick:()=>w("tts"),children:[e.jsx(et,{size:16})," èªžéŸ³è…³æœ¬"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-slate-950/50",children:[o==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 mb-3 uppercase",children:"å¿«é€ŸåŒ¯å…¥"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:xe.map(t=>e.jsxs("button",{onClick:()=>A(t),className:"px-3 py-1.5 text-xs font-bold rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-blue-50 text-slate-600 dark:text-slate-300 hover:text-blue-600 transition-colors",children:["+ ",t.name]},t.id))})]}),e.jsx("div",{className:"space-y-3",children:u.map((t,a)=>e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap items-center gap-3 bg-white dark:bg-slate-800 p-3 md:p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm transition-all hover:shadow-md",children:[e.jsx("div",{className:"w-6 text-center text-sm font-bold text-slate-400 hidden md:block",children:a+1}),e.jsxs("div",{className:"relative group flex-1 min-w-[120px]",children:[e.jsx("input",{value:t.name,onChange:n=>j(t.id,"name",n.target.value),placeholder:"è¼¸å…¥è€ƒç§‘åç¨±...",className:"w-full bg-slate-50 dark:bg-slate-900/50 border border-transparent hover:border-slate-300 dark:hover:border-slate-600 focus:border-blue-500 focus:bg-white dark:focus:bg-slate-800 font-bold text-slate-800 dark:text-white rounded-lg px-3 py-2 outline-none transition-all placeholder:font-normal",title:"é»žæ“Šä¿®æ”¹è€ƒç§‘åç¨±"}),e.jsx(ue,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-1.5 shrink-0",children:[e.jsx("input",{type:"time",value:t.start,onChange:n=>j(t.id,"start",n.target.value),className:"bg-transparent text-sm md:text-base font-mono font-bold text-slate-700 dark:text-slate-200 outline-none cursor-pointer w-[115px] md:w-[125px]"}),e.jsx("span",{className:"text-slate-300 font-bold",children:"-"}),e.jsx("input",{type:"time",value:t.end,onChange:n=>j(t.id,"end",n.target.value),className:"bg-transparent text-sm md:text-base font-mono font-bold text-slate-700 dark:text-slate-200 outline-none cursor-pointer w-[115px] md:w-[125px]"})]}),e.jsxs("select",{value:t.type,onChange:n=>j(t.id,"type",n.target.value),className:"text-sm font-bold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 rounded-lg px-3 py-2 outline-none cursor-pointer border border-transparent hover:border-slate-300",children:[e.jsx("option",{value:"class",children:"è€ƒè©¦"}),e.jsx("option",{value:"break",children:"ä¼‘æ¯"})]}),e.jsxs("div",{className:"flex items-center gap-1 md:border-l md:border-slate-200 dark:border-slate-700 md:pl-3 w-full justify-end md:w-auto mt-2 md:mt-0 shrink-0",children:[e.jsx("input",{type:"file",accept:"audio/*",id:`audio-${t.id}`,className:"hidden",onChange:n=>y(n,t.id)}),e.jsxs("label",{htmlFor:`audio-${t.id}`,className:`p-2 rounded-lg cursor-pointer transition-colors flex items-center gap-1 ${E[t.id]?"bg-blue-100 text-blue-600 hover:bg-blue-200":"text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-blue-500"}`,title:E[t.id]?"é‡æ–°ä¸Šå‚³":"ä¸Šå‚³è½åŠ›éŸ³æª”",children:[e.jsx(Le,{size:18}),!E[t.id]&&e.jsx("span",{className:"text-xs font-bold md:hidden",children:"ä¸Šå‚³éŸ³æª”"})]}),E[t.id]&&e.jsx("button",{onClick:()=>b(t.id),className:"p-2 rounded-lg text-rose-500 bg-rose-50 hover:bg-rose-100 dark:bg-rose-900/20 dark:hover:bg-rose-900/40 transition-colors",title:"åˆªé™¤éŸ³æª”",children:e.jsx(K,{size:18})}),e.jsx("div",{className:"w-[1px] h-6 bg-slate-200 dark:bg-slate-700 mx-1"}),e.jsx("button",{onClick:()=>O(t.id),className:"p-2 text-slate-300 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded-lg transition-colors",title:"åˆªé™¤æ­¤æ™‚æ®µ",children:e.jsx(ce,{size:18})})]})]},t.id))})]}),o==="announcement"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:["exam","break"].map(t=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-700 dark:text-white capitalize",children:[t==="exam"?"ðŸ”´ è€ƒè©¦ä¸­":"ðŸŸ¢ ä¸‹èª²ä¸­"," è¼ªæ’­"]}),e.jsx("button",{onClick:()=>R(t),className:"text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded font-bold hover:bg-blue-100",children:"+ æ–°å¢ž"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:H[t].map(a=>e.jsx("button",{onClick:()=>x(n=>({...n,[t]:[...n[t],a]})),className:"text-[10px] bg-slate-200 dark:bg-slate-700 px-2 py-1 rounded hover:bg-slate-300",children:a},a))}),e.jsx("div",{className:"space-y-2",children:k[t].map((a,n)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:a,onChange:_=>I(t,n,_.target.value),className:"flex-1 p-2 rounded border border-slate-200 dark:border-slate-700 text-sm bg-white dark:bg-slate-800"}),e.jsx("button",{onClick:()=>B(t,n),className:"text-slate-300 hover:text-red-500",children:e.jsx(K,{size:16})})]},n))})]},t))}),o==="tts"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"ç•¶å‰©é¤˜æ™‚é–“ç¬¦åˆæ¢ä»¶æ™‚ï¼Œç³»çµ±å°‡è‡ªå‹•æœ—è®€æ–‡å­—ã€‚"}),e.jsxs("button",{onClick:F,className:"flex items-center gap-1 text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100",children:[e.jsx(he,{size:16})," æ–°å¢žè¦å‰‡"]})]}),e.jsx("div",{className:"space-y-3",children:r.map(t=>e.jsxs("div",{className:`flex gap-4 p-4 rounded-xl border ${t.enabled?"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700":"bg-slate-50 dark:bg-slate-900 border-slate-100 opacity-60"}`,children:[e.jsxs("div",{className:"flex flex-col gap-1 w-24 shrink-0",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase",children:"é©ç”¨æ™‚æ®µ"}),e.jsx("button",{onClick:()=>P(t.id,"type",t.type==="break"?"exam":"break"),className:`flex-1 rounded-lg font-bold text-xs transition-colors border ${(t.type||"exam")==="exam"?"bg-rose-50 text-rose-600 border-rose-200 hover:bg-rose-100":"bg-emerald-50 text-emerald-600 border-emerald-200 hover:bg-emerald-100"}`,children:(t.type||"exam")==="exam"?"ðŸ”´ è€ƒè©¦ä¸­":"ðŸŸ¢ ä¸‹èª²/è€ƒå‰"})]}),e.jsxs("div",{className:"flex flex-col gap-1 w-32 shrink-0",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase",children:"å‰©é¤˜ç§’æ•¸"}),e.jsx("input",{type:"number",value:t.triggerAt,onChange:a=>P(t.id,"triggerAt",parseInt(a.target.value)),className:"w-full bg-slate-100 dark:bg-slate-700 rounded-lg px-3 py-2 font-mono text-center font-bold outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-xs text-center text-slate-400",children:["(",Math.floor(t.triggerAt/60),"åˆ† ",t.triggerAt%60,"ç§’)"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase",children:"æœ—è®€å…§å®¹"}),e.jsx("input",{type:"text",value:t.text,onChange:a=>P(t.id,"text",a.target.value),className:"w-full bg-slate-100 dark:bg-slate-700 rounded-lg px-3 py-2 font-bold outline-none focus:ring-2 focus:ring-blue-500 text-slate-700 dark:text-slate-200"})]}),e.jsxs("div",{className:"flex flex-col justify-center gap-2 border-l border-slate-100 dark:border-slate-700 pl-4",children:[e.jsx("button",{onClick:()=>P(t.id,"enabled",!t.enabled),className:`text-xs font-bold px-2 py-1 rounded ${t.enabled?"bg-green-100 text-green-700":"bg-slate-200 text-slate-500"}`,children:t.enabled?"å•Ÿç”¨":"åœç”¨"}),e.jsx("button",{onClick:()=>Q(t.id),className:"text-slate-300 hover:text-red-500 self-center",children:e.jsx(ce,{size:16})})]})]},t.id))})]})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k.active,onChange:t=>x(a=>({...a,active:t.target.checked})),id:"ticker-active",className:"w-4 h-4"}),e.jsx("label",{htmlFor:"ticker-active",className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:"å•Ÿç”¨ä¸Šæ–¹æ–‡å­—è¼ªæ’­"})]}),e.jsx("button",{onClick:s,className:"px-6 py-2 bg-slate-800 text-white rounded-lg font-bold hover:bg-slate-700",children:"å„²å­˜"})]})]})})},rt=({onOpenSettings:l,onExtend:s,isMuted:u,toggleMute:h,onQuickExam:r,onStopQuickExam:p,isQuickExam:k,isTickerActive:x,onToggleTicker:f})=>{const{theme:b,cycleTheme:E}=je(),[o,w]=me.useState(!1),A=()=>b==="system"?e.jsx(ve,{size:20}):b==="light"?e.jsx(ke,{size:20}):e.jsx(Ne,{size:20}),j=()=>b==="system"?"ç³»çµ±è¨­å®š":b==="light"?"æ·ºè‰²æ¨¡å¼":"æ·±è‰²æ¨¡å¼",O=()=>{document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),w(!1)):(document.documentElement.requestFullscreen(),w(!0))},F="flex items-center gap-1 bg-white/40 dark:bg-slate-900/40 backdrop-blur-md rounded-2xl p-1.5 border border-white/20 shadow-lg shadow-slate-200/20 dark:shadow-black/20";return e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-10 hover:z-50 flex items-center gap-4 animate-in slide-in-from-bottom-10 fade-in duration-500 opacity-20 hover:opacity-100 transition-all",children:[e.jsxs("div",{className:F,children:[e.jsx("button",{onClick:E,className:`p-2 rounded-xl transition-all shrink-0 ${c.BTN_HOVER}`,title:`åˆ‡æ›ä¸»é¡Œ (ç›®å‰ï¼š${j()})`,children:A()}),e.jsx("button",{onClick:O,className:c.BTN_HOVER,title:"å…¨èž¢å¹•",children:o?e.jsx(ze,{size:20}):e.jsx(Be,{size:20})})]}),e.jsxs("div",{className:`${F} ${c.BTN_HOVER} scale-110 mx-2 bg-white/60 dark:bg-slate-800/60 border-blue-200/30`,children:[k?e.jsx("button",{onClick:p,className:"p-4 rounded-xl bg-rose-500 hover:bg-rose-600 text-white shadow-lg shadow-rose-500/30 transition-all active:scale-95 mx-1",title:"çµæŸæ¸¬é©—",children:e.jsx(Ge,{size:24,strokeWidth:3})}):e.jsx("button",{onClick:r,className:"p-4 rounded-xl bg-indigo-500 hover:bg-indigo-600 text-white shadow-lg shadow-indigo-500/30 transition-all active:scale-95 mx-1",title:"è‡¨æ™‚æ¸¬é©—",children:e.jsx(he,{size:24,strokeWidth:3})}),e.jsx("button",{onClick:s,className:"p-4 rounded-xl bg-blue-500 hover:bg-blue-600 text-white shadow-lg shadow-blue-500/30 transition-all active:scale-95 mx-1 {UI_THEME.BTN_HOVER}",title:"å»¶é•·æ™‚é–“",children:e.jsx(ie,{size:24,strokeWidth:3})}),e.jsx("button",{onClick:h,className:c.BTN_HOVER,title:u?"è§£é™¤éœéŸ³":"éœéŸ³",children:u?e.jsx($e,{size:24,className:"text-red-500"}):e.jsx(Ue,{size:24})})]}),e.jsxs("div",{className:F,children:[e.jsx("button",{onClick:f,className:c.BTN_HOVER,title:x?"éš±è—æ–‡å­—å…¬å‘Š":"é¡¯ç¤ºæ–‡å­—å…¬å‘Š",children:x?e.jsx(be,{size:24,className:"text-emerald-500"}):e.jsx(Ze,{size:24,className:"text-slate-400 opacity-50"})}),e.jsx("button",{onClick:l,className:c.BTN_HOVER,title:"è¨­å®š",children:e.jsx(He,{size:20})})]})]})},ot=({messages:l=[],isActive:s,isGlobalZhuyin:u})=>{const h=Array.isArray(l)?l:[],[r,p]=i.useState(0),[k,x]=i.useState(!0);return i.useEffect(()=>{p(0),x(!0)},[s,h.length]),i.useEffect(()=>{if(!s||h.length===0)return;const f=8e3,b=500;let E;const o=setTimeout(()=>{x(!1),E=setTimeout(()=>{p(w=>(w+1)%h.length),x(!0)},b)},f);return()=>{clearTimeout(o),E&&clearTimeout(E)}},[r,s,h.length]),!s||h.length===0?null:e.jsx("div",{className:`
        transition-all duration-500 ease-in-out
        ${k?"opacity-100 translate-y-0":"opacity-0 translate-y-2"}
      `,children:e.jsx(Y,{text:h[r],isActive:u})})},it=({src:l})=>{const s=i.useRef(null),[u,h]=i.useState(!1),[r,p]=i.useState(0),[k,x]=i.useState(0);i.useEffect(()=>{const o=s.current;if(!o)return;const w=()=>p(o.currentTime),A=()=>x(o.duration),j=()=>h(!1);return o.addEventListener("timeupdate",w),o.addEventListener("loadedmetadata",A),o.addEventListener("ended",j),()=>{o.removeEventListener("timeupdate",w),o.removeEventListener("loadedmetadata",A),o.removeEventListener("ended",j)}},[l]);const f=()=>{u?s.current.pause():s.current.play(),h(!u)},b=o=>{const w=Number(o.target.value);s.current.currentTime=w,p(w)},E=()=>{s.current.currentTime=Math.max(0,s.current.currentTime-10)};return e.jsxs("div",{className:`mt-6 p-4 rounded-2xl w-full max-w-lg animate-in fade-in slide-in-from-bottom-4 z-50 border shadow-lg ${c.SURFACE_CARD} ${c.BORDER_DEFAULT}`,children:[e.jsx("audio",{ref:s,src:l}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:f,className:`p-3 rounded-full hover:scale-110 active:scale-95 transition-all shadow-md ${c.BTN_PRIMARY}`,children:u?e.jsx(Fe,{fill:"currentColor",size:20}):e.jsx(Pe,{fill:"currentColor",className:"ml-1",size:20})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsx("input",{type:"range",min:"0",max:k||100,value:r,onChange:b,className:"w-full accent-blue-500 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer"}),e.jsxs("div",{className:`flex justify-between text-xs font-mono ${c.TEXT_SECONDARY}`,children:[e.jsx("span",{children:new Date(r*1e3).toISOString().substr(14,5)}),e.jsx("span",{children:new Date((k||0)*1e3).toISOString().substr(14,5)})]})]}),e.jsxs("button",{onClick:E,className:`p-2 rounded-full transition-all ${c.BTN_GHOST}`,title:"å€’å¸¶ 10 ç§’",children:[e.jsx(Qe,{size:20}),e.jsx("span",{className:"text-[10px] block text-center",children:"-10s"})]})]})]})},ct=({statusData:l,attendanceStats:s,onOpenAttendance:u,announcements:h})=>{const{isGlobalZhuyin:r}=we(),{status:p,remainingSeconds:k,progress:x,slot:f,nextSlot:b,audioUrl:E}=l,[o,w]=i.useState(new Date);i.useEffect(()=>{const C=setInterval(()=>{w(new Date)},1e3);return()=>clearInterval(C)},[]);const A=new Date,j=A.getFullYear()-1911,O=String(A.getMonth()+1).padStart(2,"0"),F=String(A.getDate()).padStart(2,"0"),P=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][A.getDay()],Q=`æ°‘åœ‹${j}å¹´${O}æœˆ${F}æ—¥ (${P})`,y=C=>{const J=Math.floor(C/60),G=C%60;return`${J.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`},I=p==="break",R=p==="idle",B=p==="exam",H=()=>R?"bg-slate-300 dark:bg-slate-700":I?"bg-emerald-500":x>50?"bg-blue-600":x>20?"bg-amber-500":"bg-rose-600",t="text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.5)]",a=h??{active:!1,break:[],exam:[]},n=!!a.active,M=I||R?Array.isArray(a.break)?a.break:[]:Array.isArray(a.exam)?a.exam:[];return e.jsxs("div",{className:`relative w-full h-full flex flex-col overflow-hidden transition-colors duration-500 ${c.BACKGROUND}`,children:[e.jsx("div",{className:"w-full p-6 flex justify-between items-start z-20",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:`text-3xl md:text-xl font-black ${c.TEXT_PRIMARY} opacity-80`,children:Q}),e.jsx("div",{className:`text-3xl md:text-6xl font-black ${c.TEXT_PRIMARY} `,children:o.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})}),e.jsx("div",{className:"absolute top-8 right-8 z-30 pointer-events-auto hover:scale-110 transition-transform ease-out",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("button",{onClick:u,className:`flex items-center gap-3 px-6 py-3 rounded-full border shadow-sm hover:shadow-md transition-all group ${c.SURFACE_CARD} ${c.BORDER_DEFAULT}`,children:[e.jsx(ye,{size:24,className:c.TEXT_SECONDARY}),e.jsxs("span",{className:"font-mono font-bold text-2xl flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-60",children:"å¯¦åˆ°ï¼š"}),e.jsx("span",{className:s.actual<s.expected?"text-rose-600 dark:text-rose-400 text-4xl":c.TEXT_PRIMARY,children:s.actual}),e.jsx("span",{className:"text-sm opacity-60",children:"äºº"}),e.jsx("span",{className:"opacity-40 mx-1",children:"/"}),e.jsx("span",{className:"text-sm opacity-60",children:"æ‡‰åˆ°ï¼š"}),e.jsx("span",{children:s.expected})]}),e.jsx("span",{className:"text-sm opacity-60",children:"äºº"})]}),s.absentees.length>0&&e.jsx("div",{className:`mt-2 backdrop-blur text-sm rounded-xl p-3 max-w-[200px] animate-in fade-in slide-in-from-top-2 shadow-sm hover:shadow-md ${c.SURFACE_CARD}  ${c.BORDER_DEFAULT}`,children:e.jsxs("ul",{className:"space-y-1 ",children:[e.jsx("span",{className:"text-[20px] uppercase text-rose-400 font-bold",children:"ç¼ºå¸­"}),s.absentees.map(C=>e.jsx("li",{className:"flex flex-col",children:C.isManualNote?e.jsx("div",{className:"flex flex-col gap-1 w-full",children:e.jsx("span",{className:`font-bold text-lg leading-relaxed  whitespace-pre-wrap break-words block w-[150px] ${c.TEXT_PRIMARY} max-h-[50vh] overflow-auto`,children:C.name})}):e.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[s.absentees.idx===0&&e.jsx("span",{className:"text-[16px] uppercase text-rose-400 font-bold",children:"ç¼ºå¸­"}),e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("span",{className:`font-bold text-lg ${c.TEXT_PRIMARY}`,children:[C.number," ",C.name]}),e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-rose-100 text-rose-600 rounded",children:C.statusLabel})]})]})},C.id))]})})]})}),e.jsx("div",{className:"absolute inset-0 z-10 grid place-items-center pointer-events-none",children:e.jsx("div",{className:"w-full max-w-fulll px-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-10 animate-in slide-in-from-bottom-4 fade-in duration-700",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 -mt-16",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[(I||R)&&e.jsx(Oe,{size:36,className:"text-emerald-500 dark:text-emerald-400"}),e.jsx("h2",{className:`
              text-4xl md:text-6xl
              font-black tracking-widest uppercase text-center
              ${I?"text-emerald-600 dark:text-emerald-400":c.TEXT_PRIMARY}
            `,children:I?e.jsx(Y,{text:"ä¸‹èª²ä¼‘æ¯",isActive:r}):R?e.jsx(Y,{text:"ç›®å‰ç„¡è€ƒè©¦",isActive:r}):f?.name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:e.jsx(Y,{text:"ç›®å‰è€ƒè©¦ï¼š",isActive:r})}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:e.jsx(Y,{text:f.name,isActive:r})})]}):e.jsx(Y,{text:"æº–å‚™ä¸­",isActive:r})})]}),I&&b&&e.jsxs("div",{className:"flex items-center gap-3 px-6 py-3 rounded-xl bg-sky-50 dark:bg-sky-900/30 border-2 border-sky-200 dark:border-sky-800 text-sky-700 dark:text-sky-300 animate-pulse shadow-sm",children:[e.jsx("span",{className:"text-lg font-bold opacity-70",children:e.jsx(Y,{text:"ä¸‹ä¸€ç¯€",isActive:r})}),e.jsx(Ie,{size:20}),e.jsx("span",{className:"text-2xl font-black",children:e.jsx(Y,{text:b.name,isActive:r})})]})]}),e.jsx("div",{className:"absolute inset-0 z-10 pointer-events-none",children:e.jsxs("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-[80%]",children:[e.jsxs("div",{className:"relative w-full h-48 md:h-64 rounded-[3rem] bg-slate-200 dark:bg-slate-800 shadow-inner overflow-hidden border-4 border-slate-100 dark:border-slate-700 ring-1 ring-slate-200 dark:ring-slate-800",children:[e.jsx("div",{className:`h-full ${H()} transition-all duration-1000 ease-linear shadow-[0_0_30px_rgba(0,0,0,0.1)]`,style:{width:`${x}%`}}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center ${t} font-mono leading-none font-bold tracking-tighter tabular-nums select-none z-10`,children:R?e.jsx("span",{className:"text-[4rem] md:text-[6rem] tracking-widest opacity-80",children:"--:--"}):e.jsx("span",{className:"text-[12rem] md:text-[15rem] leading-none",children:y(k)})})]}),e.jsx("div",{className:"absolute left-1/2 top-full -translate-x-1/2 mt-6 w-[92vw] max-w-[92vw] flex justify-center z-20",style:{maxHeight:"22vh"},children:e.jsx("div",{className:"w-full text-center",children:e.jsx("div",{className:`font-bold tracking-wide ${c.TEXT_PRIMARY} break-words`,style:{fontSize:"clamp(2.4rem, 6.5vw, 7rem)",lineHeight:1.08},children:e.jsx("div",{className:"line-clamp-2",children:e.jsx(ot,{isActive:n,messages:M,isGlobalZhuyin:r})})})})})]})}),E&&!I&&e.jsx("div",{className:"absolute bottom-6 right-6 z-30 pointer-events-auto",children:e.jsx(it,{src:E})}),B&&k>0&&x<16&&e.jsxs("div",{className:"absolute inset-0 flex items-start justify-center pointer-events-none z-30 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-rose-500/10 dark:bg-rose-700/20 animate-pulse"}),e.jsx("p",{className:"mt-10 text-rose-300/70 dark:text-rose-300 text-[10vw] font-black tracking-widest select-none",children:"å³å°‡çµæŸ"})]})]})})})]})},dt=({isOpen:l,onClose:s,onConfirm:u})=>{const[h,r]=i.useState(10),[p,k]=i.useState("éš¨å ‚è€ƒ");if(!l)return null;const x=()=>{const b=parseInt(h,10);b>0&&(u(b,p||"éš¨å ‚è€ƒ"),s())},f=`w-full p-3 rounded-xl border ${c.INPUT_BASE} font-bold`;return e.jsx("div",{className:"fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:`w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden ${c.SURFACE_MAIN} border ${c.BORDER_DEFAULT}`,children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2 text-slate-800 dark:text-white",children:[e.jsx(ie,{className:"text-blue-500",size:24})," è¨­å®šè‡¨æ™‚æ¸¬é©—"]}),e.jsx("button",{onClick:s,children:e.jsx(K,{className:"text-slate-400 hover:text-slate-600"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"examtext",className:"block text-xs font-bold text-slate-400 mb-1 flex items-center gap-1",children:[e.jsx(Se,{size:12})," æ¸¬é©—æ¨™é¡Œ"]}),e.jsx("input",{name:"exam-text-input",id:"examtext",type:"text",value:p,onChange:b=>k(b.target.value),placeholder:"ä¾‹å¦‚ï¼šç¬¬ä¸€èª²å°è€ƒ",className:f,onKeyDown:b=>b.key==="Enter"&&x()})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"examtitle",className:"block text-xs font-bold text-slate-400 mb-1 flex items-center gap-1",children:[e.jsx(ie,{size:12})," æ¸¬é©—æ™‚é–“ (åˆ†é˜)"]}),e.jsx("input",{name:"exam-title-input",id:"examtitle",type:"number",min:"1",value:h,onChange:b=>r(b.target.value),className:`${f} text-2xl text-center text-blue-600 dark:text-blue-400`,onKeyDown:b=>b.key==="Enter"&&x()})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/50 flex justify-end gap-3 border-t border-slate-100 dark:border-slate-700",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-slate-500 font-bold hover:bg-slate-200 rounded-lg transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:x,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-lg shadow-blue-500/30 transition-all active:scale-95",children:"é–‹å§‹æ¸¬é©—"})]})]})})},xt=({isOpen:l,onClose:s,data:u,onSave:h})=>{const[r,p]=i.useState(u||{expected:0,actual:0,note:""});if(i.useEffect(()=>{l&&p(u||{expected:0,actual:0,note:""})},[l,u]),!l)return null;const k=()=>{h(r),s()},x=`w-full p-3 rounded-xl border ${c.INPUT_BASE} text-lg font-bold`;return e.jsx("div",{className:"fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:`w-full max-w-md rounded-2xl shadow-2xl overflow-hidden ${c.SURFACE_MAIN} border ${c.BORDER_DEFAULT}`,children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(ue,{size:20})," æ‰‹å‹•è¼¸å…¥äººæ•¸"]}),e.jsx("button",{onClick:s,children:e.jsx(K,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"æ‡‰åˆ°äººæ•¸"}),e.jsx("input",{type:"number",value:r.expected,onChange:f=>p({...r,expected:parseInt(f.target.value)||0}),className:x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"å¯¦åˆ°äººæ•¸"}),e.jsx("input",{type:"number",value:r.actual,onChange:f=>p({...r,actual:parseInt(f.target.value)||0}),className:x})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"ç¼ºå¸­/å‚™è¨» (æ–‡å­—)"}),e.jsx("textarea",{placeholder:"ä¾‹å¦‚ï¼š3è™Ÿã€15è™Ÿã€çŽ‹å°æ˜Ž",value:r.note,onChange:f=>p({...r,note:f.target.value}),className:`${x} font-normal text-base min-h-24 max-h-60 overflow-auto resize-y`})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/50 flex justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-slate-500 font-bold",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:k,className:"px-8 py-2 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700",children:"ç¢ºèªå„²å­˜"})]})]})})},jt=()=>{tt();const{classes:l=[],currentClass:s,setCurrentClassId:u,updateAttendance:h}=de(),{schedule:r,setSchedule:p,ttsRules:k,setTtsRules:x,announcements:f,setAnnouncements:b,audioFiles:E,uploadAudio:o,removeAudio:w,attendanceStats:A,currentStatus:j,setManualExtension:O,isPlayingAudio:F,toggleAudio:P,isManualMode:Q,setIsManualMode:y,manualData:I,setManualData:R,startQuickExam:B,stopQuickExam:H,isQuickExam:t,isMuted:a,setIsMuted:n}=nt(),{dialogConfig:_,openDialog:M,closeDialog:C}=Ee(),[J,G]=i.useState(!1),[ae,ee]=i.useState(!1),[V,q]=i.useState(!0),[ne,le]=i.useState(!1),[m,S]=i.useState(!1),g=()=>n(d=>!d);i.useEffect(()=>{j.status==="exam"&&q(!1)},[j.status]);const T=()=>{S(!0)},v=()=>{M({isOpen:!0,title:"çµæŸæ¸¬é©—",message:"ç¢ºå®šè¦çµæŸç›®å‰çš„è‡¨æ™‚æ¸¬é©—å—Žï¼Ÿ",type:"confirm",variant:"danger",onConfirm:()=>{H(),C()},onClose:C})},N=()=>{M({isOpen:!0,title:"å»¶é•·è€ƒè©¦æ™‚é–“",message:"è«‹è¼¸å…¥è¦å»¶é•·çš„åˆ†é˜æ•¸ (ä¾‹å¦‚: 5)",type:"prompt",onConfirm:d=>{const z=Number.parseInt(d,10);Number.isFinite(z)&&O(L=>L+z),C()},onClose:C})},D=()=>{b(d=>({...d,active:!d.active}))},$=me.useMemo(()=>r.map(d=>{const z=j.status==="exam"&&j.slot?.id===d.id,L=j.status==="break"&&j.nextSlot?.id===d.id;let U="relative p-4 rounded-xl border-2 transition-all duration-300 ";return z?U+="bg-blue-50 dark:bg-blue-900/40 border-blue-500 shadow-lg scale-105 z-10":L?U+="bg-amber-50/50 dark:bg-amber-900/20 border-amber-400 border-dashed animate-pulse ring-2 ring-amber-100 dark:ring-amber-900/30":U+="bg-white dark:bg-slate-800 border-slate-100 dark:border-slate-700 opacity-60 hover:opacity-100",e.jsxs("div",{className:U,children:[z&&e.jsxs("div",{className:"absolute -top-3 right-3 bg-blue-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold flex items-center gap-1 shadow-sm",children:[e.jsx(Me,{size:10})," é€²è¡Œä¸­"]}),L&&e.jsxs("div",{className:"absolute -top-3 right-3 bg-amber-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold flex items-center gap-1 shadow-sm",children:[e.jsx(Ce,{size:10})," ä¸‹ä¸€ç§‘"]}),e.jsxs("div",{className:"text-xs font-mono font-bold text-slate-400 mb-1",children:[d.start," - ",d.end]}),e.jsx("div",{className:`font-bold text-lg leading-tight ${z?"text-blue-700 dark:text-blue-300":L?"text-amber-700 dark:text-amber-300":"text-slate-700 dark:text-slate-300"}`,children:d.name})]},d.id)}),[r,j.status,j.slot?.id,j.nextSlot?.id]);return e.jsxs("div",{className:`w-full h-full flex overflow-hidden ${c.BACKGROUND}`,children:[e.jsx("div",{className:`relative transition-all duration-500 border-r ${c.BORDER_DEFAULT} ${c.SURFACE_MAIN} flex flex-col ${V?"w-80":"w-0"} overflow-hidden`,children:e.jsxs("div",{className:"p-6 overflow-hidden min-w-[20rem]",children:[e.jsxs("h2",{className:`text-2xl font-bold mb-4 flex items-center gap-2 ${c.TEXT_PRIMARY}`,children:[e.jsx(Te,{className:"text-blue-500"})," ä»Šæ—¥è€ƒç¨‹"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"exam-class-selector",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"ç­ç´šé¸æ“‡"}),e.jsxs("select",{id:"exam-class-selector",name:"examClass",className:`w-full px-3 py-2 rounded-lg border ${c.INPUT_BASE}`,value:Q?"manual-mode":s?.id||"",onChange:d=>{d.target.value==="manual-mode"?y(!0):(y(!1),u&&u(d.target.value))},children:[e.jsx("option",{value:"manual-mode",children:"ðŸ“ æ‰‹å‹•è¼¸å…¥æ¨¡å¼ (è‡ªå®šç¾©)"}),e.jsx("optgroup",{label:"æˆ‘çš„ç­ç´š",children:l.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["æ‡‰åˆ°ï¼š",A.expected,"ã€€å¯¦åˆ°ï¼š",A.actual]})]}),e.jsx("div",{className:"space-y-4 pb-20",children:$})]})}),e.jsx("button",{onClick:()=>q(!V),className:"absolute bottom-15 left-0 z-100 -translate-y-1/2 bg-white dark:bg-slate-800 p-1 rounded-r-lg shadow-md border border-l-0 border-slate-200 dark:border-slate-700 text-slate-400 hover:text-blue-500 transition-all ease-in-out duration-500",style:{left:V?"20rem":"0"},children:V?e.jsx(Ye,{}):e.jsx(Xe,{})}),e.jsx("main",{className:"flex-1 relative",children:e.jsx(ct,{statusData:j,isPlayingAudio:F,toggleAudio:P,attendanceStats:A,onOpenAttendance:()=>{Q?le(!0):ee(!0)},announcements:f})}),e.jsx(xt,{isOpen:ne,onClose:()=>le(!1),data:I,onSave:R}),e.jsx(rt,{onOpenSettings:()=>G(!0),onExtend:N,onQuickExam:T,onStopQuickExam:v,isQuickExam:t,isTickerActive:f.active,onToggleTicker:D,isMuted:a,toggleMute:g}),ae&&s&&e.jsx(_e,{isOpen:ae,onClose:()=>ee(!1),students:s.students||[],attendanceRecords:s.attendanceRecords||{},onSave:h}),e.jsx(lt,{isOpen:J,onClose:()=>G(!1),schedule:r,setSchedule:p,ttsRules:k,setTtsRules:x,announcements:f,setAnnouncements:b,uploadAudio:o,removeAudio:w,audioFiles:E}),e.jsx(dt,{isOpen:m,onClose:()=>S(!1),onConfirm:(d,z)=>{B(d,z)}}),_&&e.jsx(Ae,{..._,onClose:C})]})};export{jt as default};
