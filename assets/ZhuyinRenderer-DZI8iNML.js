import{r as f,j as z}from"./index-FQBKIusJ.js";const x={"○":"圈","△":"三角形","□□":"框框","□":"框框","打×":"打叉",打X:"打叉",打x:"打叉","打✕":"打叉","打○":"打圈",打O:"打圈",打o:"打圈","①":"一","②":"二","③":"三","④":"四","⑤":"五","⑥":"六","⑦":"七","⑧":"八","⑨":"九","⑩":"十","→":"、","⇒":"、"},b={"×":"乘以","÷":"除以","＋":"加","+":"加","－":"減","-":"減","＝":"等於","=":"等於","≠":"不等於","≈":"約等於","±":"正負","≤":"小於或等於","≥":"大於或等於","∠":"角","⊥":"垂直於","∥":"平行於",π:"圓周率","∴":"所以","∵":"因為","≅":"全等於","∼":"相似於","∞":"無限大","√":"根號"},O={Ω:"歐姆",μ:"微",λ:"波長",Δ:"變化量",θ:"西塔","℃":"攝氏度","℉":"華氏度","⇌":"可逆反應","↑":"產生氣體","↓":"產生沉澱"},M={km:"公里",m:"公尺",cm:"公分",mm:"毫米",μm:"微米",nm:"奈米",kg:"公斤",g:"公克",mg:"毫克",t:"公噸",L:"公升",ml:"毫升","c.c.":"西西",Hz:"赫茲",dB:"分貝",mA:"毫安培",kW:"千瓦",kWh:"度電",ppm:"百萬分點",AM:"上午",PM:"下午"},P={...x,...b,...O,...M},A={km:"公里",m:"公尺",cm:"公分",mm:"毫米",kg:"公斤",g:"公克",t:"公噸",L:"公升",ml:"毫升","c.c.":"西西",hr:"小時",h:"小時",s:"秒",min:"分鐘"},Z={"₀":"零","₁":"一","₂":"二","₃":"三","₄":"四","₅":"五","₆":"六","₇":"七","₈":"八","₉":"九","₊":"正","₋":"負","ₓ":"x","ₐ":"a","ₑ":"e","ₒ":"o"},B=(n="general")=>{const c={...x};switch(n){case"math":case"science":return{...c,...b,...O,...M};case"english":return c;default:return P}},W=(n="general")=>{const c=[{pattern:/[(（「【][\s_＿]*[)）」】]/g,replacement:"、空格、"},{pattern:/[_＿]{3,}/g,replacement:"、"},{pattern:/(\d+)\/(\d+)/g,replacement:(a,o,m)=>`${m}分之${o}`}];return n!=="english"&&c.push({pattern:/\b(km|m|cm|mm)([\^]?)([23²³])(?!\d)/gi,replacement:(a,o,m,h)=>{const s=h==="2"||h==="²"?"平方":"立方",$=A[o.toLowerCase()]||o;return`${s}${$}`}},{pattern:/([a-zA-Z0-9])(?:[\^]([a-zA-Z0-9]+)|([⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻ⁿˣʸ]+))/g,replacement:(a,o,m,h)=>{const s={"⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","⁺":"+","⁻":"-",ⁿ:"n",ˣ:"x",ʸ:"y"};let $=m;return h&&($=h.split("").map(g=>s[g]||g).join("")),`${o}的${$}次方`}},{pattern:/([₀-₉₊₋ₓₐₑₒ])/g,replacement:a=>Z[a]||a},{pattern:/\b(km|m)\/(hr|h|s|min)\b/gi,replacement:(a,o,m)=>{const h=A[o.toLowerCase()]||o;return`每${A[m.toLowerCase()]||m}${h}`}},{pattern:/(\d+)\s*([CcFf])\b/g,replacement:(a,o,m)=>{const h=m.toLowerCase()==="c"?"度":"華氏度";return`${o}${h}`}}),c},j=(n,c="general")=>{if(!n)return"";let a={};try{a=JSON.parse(localStorage.getItem("tts_custom_dict"))||{}}catch{}const m={...B(c),...a},h=W(c),s=Object.keys(m).sort((p,d)=>d.length-p.length);let $=n;h.forEach(({pattern:p,replacement:d})=>{p.lastIndex=0,$=$.replace(p,typeof d=="function"?d:()=>d)});let g="",l=0;for(;l<$.length;){const p=$.slice(l).match(/^[(（]\s*([A-FＡ-Ｆa-fａ-ｆ]|[0-9０-９]{1,2}|甲|乙|丙|丁)\s*[)）]/),d=$.slice(l).match(/^([①-⑳])/);if(p){let i=p[1].toUpperCase();/^[0-9]+$/.test(i)?i={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十"}[i]||i:/^[A-Z]$/.test(i)&&(i=String.fromCharCode(i.charCodeAt(0)+65248)),g+=`${i}、`,l+=p[0].length;continue}else if(d){const i=d[1],E=m[i]||i;g+=`${E}、`,l+=d[0].length;continue}let T=s.find(i=>$.startsWith(i,l));if(T&&/^[a-zA-Z.]+$/.test(T)){const i=l>0?$[l-1]:"",E=$[l+T.length]||"",D=/[a-zA-Z]/;(D.test(i)||D.test(E))&&(T=void 0)}T?(g+=m[T],l+=T.length):(g+=$[l],l++)}return/[。？！.?!]$/.test(g)||(g+="。"),g},X=()=>{const[n,c]=f.useState([]),[a,o]=f.useState(null),[m,h]=f.useState("stopped"),s=typeof window<"u"?window.speechSynthesis:null,$=f.useRef(0),g=f.useRef([]),l=f.useRef(0),p=f.useRef("general"),d=f.useRef(1),T=f.useMemo(()=>{const u=r=>String(r?.lang||"").toLowerCase().startsWith("zh"),R=r=>!String(r?.lang||"").toLowerCase().includes("zh-hk"),_=n.filter(r=>u(r)&&R(r)),C=(r="")=>r.includes("Online (Natural)")?0:r.includes("Yating")?1:r.includes("Mei-Jia")?4:9;return _.sort((r,S)=>{const k=(S.localService?0:1)-(r.localService?0:1);return k!==0?k:C(r.name)-C(S.name)})[0]||null},[n]),i=f.useRef(null);f.useEffect(()=>{i.current=T},[T]);const E=f.useCallback(()=>{$.current+=1,s&&s.cancel(),h("stopped"),o(null)},[s]),D=f.useCallback(u=>{if(u!==$.current)return;const R=g.current,_=l.current;if(_>=R.length){h("stopped"),o(null);return}const C=R[_],r=j(C.spokenText,p.current);if(!r||r.trim()==="。"){l.current+=1,D(u);return}const S=new SpeechSynthesisUtterance(r);S.lang="zh-TW",S.rate=d.current,i.current&&(S.voice=i.current),S.onstart=()=>{u===$.current&&(o(C.id),h("playing"))},S.onend=()=>{u===$.current&&(l.current+=1,D(u))},S.onerror=k=>{k.error!=="canceled"&&u===$.current&&(console.warn("TTS Error on chunk:",C.id,k),l.current+=1,D(u))},s.speak(S)},[s]),L=f.useCallback((u,R="general",_=.9,C=null)=>{if(!s||!u)return;E();let r=[];if(typeof u=="string"?r=[{id:"sys_msg",text:u,spokenText:u}]:Array.isArray(u)&&(r=u),r.length===0)return;const S=$.current;g.current=r,p.current=R,d.current=Math.max(.5,Math.min(1.05,_));let k=0;if(C){const N=r.findIndex(v=>v.id===C);N!==-1&&(k=N)}l.current=k,setTimeout(()=>{D(S)},50)},[s,E,D]),V=f.useCallback(()=>{s&&(s.pause(),h("paused"))},[s]),w=f.useCallback(()=>{s&&(s.resume(),h("playing"))},[s]);return f.useEffect(()=>{if(!s)return;const u=()=>c(s.getVoices());return u(),s.onvoiceschanged=u,()=>{s.onvoiceschanged=null,E()}},[s,E]),{speak:L,cancel:E,pauseTTS:V,resumeTTS:w,ttsState:m,voices:n,activeChunkId:a}},e="󠇡",t="󠇢",U="󠇣",y="󠇤",H={一個:`一${e}個`,一次:`一${e}次`,一定:`一${e}定`,一半:`一${e}半`,一樣:`一${e}樣`,一陣:`一${e}陣`,一切:`一${e}切`,一塊:`一${e}塊`,一部:`一${e}部`,一直:`一${t}直`,一起:`一${t}起`,一天:`一${t}天`,一生:`一${t}生`,一般:`一${t}般`,一些:`一${t}些`,一點:`一${t}點`,一隻:`一${t}隻`,一邊:`一${t}邊`,不是:`不${e}是`,不要:`不${e}要`,不對:`不${e}對`,不錯:`不${e}錯`,不會:`不${e}會`,不再:`不${e}再`,不用:`不${e}用`,不夠:`不${e}夠`,不見:`不${e}見`},F={校長:`校長${e}`,長大:`長${e}大`,村長:`村長${e}`,班長:`班長${e}`,師長:`師長${e}`,成長:`成長${e}`,行長:`行${e}長${e}`,銀行:`銀行${e}`,行業:`行${e}業`,內行:`內行${e}`,外行:`外行${e}`,上一行:`上一${t}行${e}`,下一行:`下一${t}行${e}`,音樂:`音樂${e}`,樂器:`樂${e}器`,樂隊:`樂${e}隊`,國樂:`國樂${e}`,弦樂:`弦樂${e}`,睡覺:`睡覺${e}`,午覺:`午覺${e}`,教書:`教${e}書`,教人:`教${e}人`,重複:`重${e}複`,重新:`重${e}新`,重來:`重${e}來`,重疊:`重${e}疊`,因為:`因為${e}`,為了:`為${e}了`,為什麼:`為${e}什麼`,以為:`以為${e}`,學務處:`學務處${e}`,教務處:`教務處${e}`,總務處:`總務處${e}`,跌倒:`跌倒${e}`,空地:`空${e}地`,空白:`空${e}白`,有空:`有空${e}`,照相:`照相${e}`,相片:`相${e}片`,長相:`長相${e}`,相機:`相${e}機`,便當:`便當${e}`,上當:`上當${e}`,妥當:`妥當${e}`,當鋪:`當${e}鋪`,放假:`放假${e}`,暑假:`暑假${e}`,寒假:`寒假${e}`,請假:`請假${e}`,春假:`春假${e}`,好奇:`好${e}奇`,好動:`好${e}動`,愛好:`愛好${e}`,很差:`很差${y}`,差不多:`差${y}不多`,出差:`出差${e}`,郵差:`郵差${e}`,參差:`參${t}差${t}`,人參:`人參${e}`,得要:`得${t}要`,得先:`得${t}先`,得做:`得${t}做`,你得:`你得${t}`,看著:`看著${e}`,想著:`想著${e}`,急著:`急著${e}`,著火:`著${t}火`,著急:`著${t}急`,著名:`著${t}名`,還有:`還${t}有`,還沒:`還${t}沒`,還是:`還${t}是`,歸還:`歸還${e}`,還書:`還${e}書`,三更:`三更${e}`,要求:`要${e}求`,重要:"重要",需要:`需${e}要`,要不要:`要${t}不要`,和麵:`和${U}麵`,打中:`打中${e}`,命中:`命中${e}`,選中:`選中${e}`,分數:`分${e}數`,身分:`身分${e}`,分內:`分${e}內`,力量:`力${e}量`,測量:`測量${e}`,量杯:`量${t}杯`,量一量:`量${t}一量${t}`,便宜:`便${e}宜`,隨便:`隨便${t}`},K={會計:`會${e}計`,滑稽:`滑${e}稽`,主角:`主角${e}`,角色:`角${e}色`,說客:`說${e}客`,游說:`游說${e}`,創傷:`創${e}傷`,否極泰來:`否${e}極泰來`},I={...H,...F,...K},Y=Object.keys(I).sort((n,c)=>c.length-n.length),J=n=>{if(!n||typeof n!="string")return n;let c=n;return Y.forEach(a=>{if(c.includes(a)){const o=I[a];c=c.split(a).join(o)}}),c},q=({text:n,isActive:c,className:a=""})=>{if(!n)return null;const o=c?`font-with-zhuyin ${a}`:a,m=c?J(n):n;return z.jsx("span",{className:o.trim(),children:m})},G=(n,c)=>n.text===c.text&&n.isActive===c.isActive&&n.className===c.className,ee=f.memo(q,G);export{ee as Z,J as f,X as u};
